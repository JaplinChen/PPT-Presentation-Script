import React, { useState } from 'react';
import { Settings, Key, Server, Cpu, Globe, Database, Save, Eye, EyeOff, CheckCircle, RefreshCw } from 'lucide-react';

const ConfigField = ({ label, type = "text", placeholder, value, hint, isPassword = false }) => {
  const [showPassword, setShowPassword] = useState(false);
  
  return (
    <div className="mb-4">
      <label className="block text-xs font-mono font-bold text-gray-400 uppercase tracking-wider mb-1">
        {label}
      </label>
      <div className="relative">
        <input 
          type={isPassword && !showPassword ? "password" : "text"}
          className="w-full bg-gray-900 border border-gray-700 rounded p-2 text-sm text-gray-200 font-mono focus:border-blue-500 focus:outline-none transition-colors"
          placeholder={placeholder}
          defaultValue={value}
        />
        {isPassword && (
          <button 
            onClick={() => setShowPassword(!showPassword)}
            className="absolute right-2 top-2 text-gray-500 hover:text-gray-300"
          >
            {showPassword ? <EyeOff size={16} /> : <Eye size={16} />}
          </button>
        )}
      </div>
      {hint && <p className="text-[10px] text-gray-500 mt-1">{hint}</p>}
    </div>
  );
};

const SliderField = ({ label, min, max, step, defaultValue }) => {
  const [val, setVal] = useState(defaultValue);
  return (
    <div className="mb-4">
      <div className="flex justify-between mb-1">
        <label className="text-xs font-mono font-bold text-gray-400 uppercase tracking-wider">{label}</label>
        <span className="text-xs font-mono text-blue-400">{val}</span>
      </div>
      <input 
        type="range" 
        min={min} 
        max={max} 
        step={step} 
        value={val}
        onChange={(e) => setVal(e.target.value)}
        className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"
      />
    </div>
  );
};

export default function AIConfigDashboard() {
  const [activeTab, setActiveTab] = useState('openai');

  const providers = [
    { id: 'openai', name: 'OpenAI', icon: <Globe size={18} />, desc: '標準雲端 API' },
    { id: 'anthropic', name: 'Anthropic', icon: <Cpu size={18} />, desc: 'Claude 系列' },
    { id: 'google', name: 'Google Gemini', icon: <Database size={18} />, desc: 'Google AI Studio / Vertex' },
    { id: 'azure', name: 'Azure OpenAI', icon: <Server size={18} />, desc: '企業私有部署' },
    { id: 'ollama', name: 'Ollama (Local)', icon: <Settings size={18} />, desc: '本地端模型' },
  ];

  const renderContent = () => {
    switch(activeTab) {
      case 'openai':
        return (
          <div className="animate-fade-in">
            <div className="flex items-center justify-between mb-6 border-b border-gray-700 pb-4">
              <div>
                <h2 className="text-xl font-bold text-white flex items-center gap-2">
                  <Globe className="text-green-500" /> OpenAI Configuration
                </h2>
                <p className="text-xs text-gray-500 font-mono mt-1">PROVIDER_ID: openai</p>
              </div>
              <div className="px-2 py-1 bg-green-900/30 border border-green-800 rounded text-green-400 text-xs font-mono">
                Status: Operational
              </div>
            </div>
            
            <ConfigField label="API Key" type="password" isPassword={true} placeholder="sk-..." hint="Keys are never stored in plain text." />
            <ConfigField label="Organization ID (Optional)" placeholder="org-..." hint="Required for users in multiple organizations." />
            
            <div className="grid grid-cols-2 gap-4">
               <div className="mb-4">
                <label className="block text-xs font-mono font-bold text-gray-400 uppercase tracking-wider mb-1">Model</label>
                <select className="w-full bg-gray-900 border border-gray-700 rounded p-2 text-sm text-gray-200 font-mono focus:border-blue-500">
                  <option>gpt-4o</option>
                  <option>gpt-4-turbo</option>
                  <option>gpt-3.5-turbo</option>
                </select>
               </div>
               <ConfigField label="Max Tokens" value="4096" />
            </div>

            <div className="p-4 bg-gray-800/50 rounded border border-gray-700 mb-4">
              <SliderField label="Temperature" min="0" max="2" step="0.1" defaultValue="0.7" />
              <SliderField label="Top P (Nucleus)" min="0" max="1" step="0.05" defaultValue="1.0" />
            </div>
            
            <ConfigField label="Base URL (Proxy)" placeholder="https://api.openai.com/v1" hint="Leave empty for default. Use for custom proxies." />
          </div>
        );

      case 'anthropic':
        return (
          <div className="animate-fade-in">
            <div className="flex items-center justify-between mb-6 border-b border-gray-700 pb-4">
              <div>
                <h2 className="text-xl font-bold text-white flex items-center gap-2">
                  <Cpu className="text-purple-500" /> Anthropic Configuration
                </h2>
                <p className="text-xs text-gray-500 font-mono mt-1">PROVIDER_ID: anthropic</p>
              </div>
            </div>

            <ConfigField label="API Key" type="password" isPassword={true} placeholder="sk-ant-..." />
            
            <div className="mb-4">
              <label className="block text-xs font-mono font-bold text-gray-400 uppercase tracking-wider mb-1">Model</label>
              <select className="w-full bg-gray-900 border border-gray-700 rounded p-2 text-sm text-gray-200 font-mono focus:border-blue-500">
                <option>claude-3-5-sonnet-20240620</option>
                <option>claude-3-opus-20240229</option>
                <option>claude-3-haiku-20240307</option>
              </select>
            </div>

            <SliderField label="Temperature" min="0" max="1" step="0.1" defaultValue="0.5" />
            <ConfigField label="Max Output Tokens" value="8192" hint="Claude supports up to 4096 or 8192 depending on the model." />
          </div>
        );

      case 'google':
        return (
          <div className="animate-fade-in">
            <div className="flex items-center justify-between mb-6 border-b border-gray-700 pb-4">
              <div>
                <h2 className="text-xl font-bold text-white flex items-center gap-2">
                  <Database className="text-blue-500" /> Google Gemini
                </h2>
                <p className="text-xs text-gray-500 font-mono mt-1">PROVIDER_ID: google</p>
              </div>
            </div>

            <ConfigField label="API Key" type="password" isPassword={true} placeholder="AIza..." hint="From Google AI Studio." />
            
            <div className="mb-4">
              <label className="block text-xs font-mono font-bold text-gray-400 uppercase tracking-wider mb-1">Model</label>
              <select className="w-full bg-gray-900 border border-gray-700 rounded p-2 text-sm text-gray-200 font-mono focus:border-blue-500">
                <option>gemini-1.5-pro</option>
                <option>gemini-1.5-flash</option>
                <option>gemini-1.0-pro</option>
              </select>
            </div>

            <div className="p-3 bg-blue-900/20 border border-blue-800/50 rounded mb-4">
              <h4 className="text-xs font-bold text-blue-400 mb-2">SAFETY SETTINGS (BLOCK THRESHOLD)</h4>
              <div className="grid grid-cols-2 gap-2">
                 <div className="bg-gray-900 p-2 rounded text-xs text-gray-400">Harassment: <span className="text-gray-200">Block None</span></div>
                 <div className="bg-gray-900 p-2 rounded text-xs text-gray-400">Hate Speech: <span className="text-gray-200">Block None</span></div>
              </div>
            </div>
            
             <ConfigField label="Top K" value="64" hint="Limits the number of tokens to consider for each step." />
          </div>
        );

      case 'azure':
        return (
          <div className="animate-fade-in">
             <div className="flex items-center justify-between mb-6 border-b border-gray-700 pb-4">
              <div>
                <h2 className="text-xl font-bold text-white flex items-center gap-2">
                  <Server className="text-blue-400" /> Azure OpenAI
                </h2>
                <p className="text-xs text-gray-500 font-mono mt-1">PROVIDER_ID: azure_openai</p>
              </div>
              <div className="px-2 py-1 bg-blue-900/30 border border-blue-800 rounded text-blue-400 text-xs font-mono">
                Enterprise
              </div>
            </div>

            <div className="bg-yellow-900/20 border border-yellow-800/50 p-3 rounded mb-4 text-xs text-yellow-500 font-mono">
              ⚠️ Azure requires distinct Deployment Names, not just Model names.
            </div>

            <ConfigField label="Endpoint URL" placeholder="https://{resource}.openai.azure.com/" />
            <ConfigField label="API Key" type="password" isPassword={true} placeholder="32-char hex string" />
            
            <div className="grid grid-cols-2 gap-4">
               <ConfigField label="Deployment Name" placeholder="e.g. my-gpt4-deploy" hint="The name you assigned in Azure Portal." />
               <ConfigField label="API Version" placeholder="2024-02-15-preview" />
            </div>
          </div>
        );

      case 'ollama':
        return (
          <div className="animate-fade-in">
             <div className="flex items-center justify-between mb-6 border-b border-gray-700 pb-4">
              <div>
                <h2 className="text-xl font-bold text-white flex items-center gap-2">
                  <Settings className="text-orange-500" /> Ollama / Local AI
                </h2>
                <p className="text-xs text-gray-500 font-mono mt-1">PROVIDER_ID: ollama</p>
              </div>
              <div className="px-2 py-1 bg-orange-900/30 border border-orange-800 rounded text-orange-400 text-xs font-mono flex items-center gap-1">
                 <RefreshCw size={10} className="animate-spin" /> Connecting...
              </div>
            </div>

            <ConfigField label="Base URL" value="http://localhost:11434" hint="Default Ollama port." />
            
            <div className="flex gap-2 items-end mb-4">
               <div className="flex-grow">
                 <label className="block text-xs font-mono font-bold text-gray-400 uppercase tracking-wider mb-1">Model Name</label>
                 <input className="w-full bg-gray-900 border border-gray-700 rounded p-2 text-sm text-gray-200 font-mono" defaultValue="llama3" />
               </div>
               <button className="bg-gray-700 hover:bg-gray-600 text-white p-2 rounded border border-gray-600 h-[38px] text-xs font-mono">
                 Pull Model
               </button>
            </div>

            <div className="grid grid-cols-2 gap-4">
               <ConfigField label="Context Window (Num Ctx)" value="4096" />
               <ConfigField label="Keep Alive" value="5m" hint="Time to keep model in memory." />
            </div>

            <div className="p-3 bg-gray-900 rounded border border-gray-800">
               <div className="flex items-center gap-2 mb-2">
                 <div className="w-2 h-2 rounded-full bg-red-500"></div>
                 <span className="text-xs text-gray-400 font-mono">Server Status: Disconnected</span>
               </div>
               <button className="w-full bg-gray-800 hover:bg-gray-700 text-xs text-gray-300 py-1 rounded border border-gray-700">Retry Connection</button>
            </div>
          </div>
        );
      
      default:
        return null;
    }
  };

  return (
    <div className="w-full max-w-4xl mx-auto bg-[#0d1117] border border-gray-800 rounded-lg shadow-2xl overflow-hidden font-sans text-gray-300">
      <div className="flex h-[600px]">
        {/* Sidebar */}
        <div className="w-64 bg-[#161b22] border-r border-gray-800 flex flex-col">
          <div className="p-4 border-b border-gray-800">
            <h1 className="text-sm font-bold text-gray-100 uppercase tracking-widest">Settings</h1>
          </div>
          <div className="flex-1 overflow-y-auto py-2">
            {providers.map((p) => (
              <button
                key={p.id}
                onClick={() => setActiveTab(p.id)}
                className={`w-full text-left px-4 py-3 flex items-center gap-3 transition-colors ${
                  activeTab === p.id 
                    ? 'bg-blue-900/20 text-blue-400 border-r-2 border-blue-500' 
                    : 'text-gray-400 hover:bg-gray-800 hover:text-gray-200'
                }`}
              >
                {p.icon}
                <div>
                  <div className="font-medium text-sm">{p.name}</div>
                  <div className="text-[10px] opacity-60">{p.desc}</div>
                </div>
              </button>
            ))}
          </div>
          <div className="p-4 border-t border-gray-800 text-[10px] text-gray-600 font-mono">
            v2.4.0-release
          </div>
        </div>

        {/* Main Content */}
        <div className="flex-1 flex flex-col bg-[#0d1117]">
          <div className="flex-1 p-8 overflow-y-auto">
            {renderContent()}
          </div>
          
          {/* Action Bar */}
          <div className="p-4 border-t border-gray-800 bg-[#161b22] flex justify-end gap-3">
             <button className="px-4 py-2 rounded text-sm font-medium text-gray-400 hover:text-white transition-colors">
               Cancel
             </button>
             <button className="px-4 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium flex items-center gap-2 shadow-lg shadow-blue-900/20">
               <Save size={16} /> Save Changes
             </button>
          </div>
        </div>
      </div>
    </div>
  );
}